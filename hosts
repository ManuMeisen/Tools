#!/bin/bash

# Función para realizar un ping a un host y extraer el TTL de la respuesta
get_ttl() {
    local host="$1"
    local ttl=$(ping -c 1 -w 1 "$host" | grep "ttl=" | sed 's/.*ttl=\([0-9]*\).*/\1/' 2>/dev/null)
    if [ -z "$ttl" ]; then
        ttl="Unknown"
    fi
    echo "$ttl"
}

# Función para determinar el sistema operativo basado en el TTL
get_os() {
    local ttl="$1"
    local os="Unknown"
    if [ "$ttl" == "Unknown" ]; then
        return
    elif [ "$ttl" -eq 63 ] || [ "$ttl" -eq 64 ]; then
        os="Linux/Unix"
    elif [ "$ttl" -eq 127 ] || [ "$ttl" -eq 128 ]; then
        os="Windows"
    fi
    echo "$os"
}

# Rango de direcciones IP a escanear (modifica según tus necesidades)
start_ip="192.168.1.1"
end_ip="192.168.1.254"

# Bucle para escanear cada dirección IP en el rango especificado
for ((i = $(echo "$start_ip" | cut -d '.' -f 4); i <= $(echo "$end_ip" | cut -d '.' -f 4); i++)); do
    ip=$(echo "$start_ip" | cut -d '.' -f 1-3)."$i"
    (
        ttl=$(get_ttl "$ip")
        os=$(get_os "$ttl")
        if [ "$os" != "Unknown" ] && [ "$ttl" != "Unknown" ]; then
            echo "Host: $ip - TTL: $ttl - Sistema Operativo: $os"
        fi
    ) &
done

# Esperar a que todos los subprocesos terminen
wait
